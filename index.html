<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - FLUTTERWAVE</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Inter', sans-serif;
      background-color: #f4f6f8;
      overflow-x: hidden;
    }

    h2 {
      font-weight: 700;
      margin: 0 0 20px 0;
      color: #4B2BD9;
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-weight: 600;
    }

    .admin-dashboard {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      padding: 0 10px;
      box-sizing: border-box;
      background: #fff;
      overflow-y: auto;
    }

    .logout-btn {
      align-self: flex-end;
      background: #6c2bd9;
      color: #fff;
      padding: 8px 16px;
      margin: 10px 0;
    }

    .stats {
      font-size: 16px;
      margin-bottom: 15px;
    }

    #searchInput {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 25px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .user-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 10px;
      width: 100%;
    }

    .user-card {
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .user-card div {
      font-size: 14px;
    }

    .user-card label {
      font-weight: 600;
      color: #555;
      margin-right: 5px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .edit-btn { background-color: #f0ad4e; color: #fff; }
    .delete-btn { background-color: #d9534f; color: #fff; }
    .save-btn { background-color: #5cb85c; color: #fff; }
    .cancel-btn { background-color: #6c757d; color: #fff; }

    .edit-input {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      box-sizing: border-box;
    }

    @media(max-width: 600px) {
      .user-cards {
        grid-template-columns: 1fr;
      }
      .logout-btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="admin-dashboard">
    <button class="logout-btn" onclick="logout()">Log Out</button>
    <h2>Admin Dashboard</h2>

    <div class="stats">Total users: <span id="userCount">0</span></div>
    <input type="text" id="searchInput" placeholder="Search users..." oninput="loadUsers()">

    <div id="userCardContainer" class="user-cards"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCbuLoyGu6v7dJUDQ0iM2DkvEZs0D9z2Do",
      authDomain: "mfs-africa-ltd.firebaseapp.com",
      databaseURL: "https://mfs-africa-ltd-default-rtdb.firebaseio.com",
      projectId: "mfs-africa-ltd",
      storageBucket: "mfs-africa-ltd.appspot.com",
      messagingSenderId: "686833267635",
      appId: "1:686833267635:web:c5a531346887f6452bd1c6"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function logout() {
      localStorage.removeItem('loggedInUser');
      window.location.href = 'login.html';
    }

    function loadUsers() {
      const container = document.getElementById('userCardContainer');
      const userCount = document.getElementById('userCount');
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

      database.ref('users').once('value', snapshot => {
        const users = snapshot.val() || {};
        const userList = Object.entries(users).map(([id, data]) => ({ id, ...data }));

        const filtered = userList.filter(user =>
          user.name?.toLowerCase().includes(searchTerm) ||
          user.username?.toLowerCase().includes(searchTerm) ||
          user.email?.toLowerCase().includes(searchTerm) ||
          user.phone?.toLowerCase().includes(searchTerm)
        );

        container.innerHTML = '';
        filtered.forEach(user => {
          const card = document.createElement('div');
          card.className = 'user-card';
          card.id = `card-${user.id}`;

          card.innerHTML = `
            <div><label>Name:</label><span class="field name">${user.name || ''}</span></div>
            <div><label>Username:</label><span class="field username">${user.username || ''}</span></div>
            <div><label>Phone:</label><span class="field phone">${user.phone || ''}</span></div>
            <div><label>Email:</label><span class="field email">${user.email || ''}</span></div>
            <div><label>Balance:</label><span class="field balance">${user.balance || 0}</span></div>
            <div><label>Pending:</label><span class="field pending">${user.pending || 0}</span></div>
            <div><label>Deposit:</label><span class="field deposit">${user.deposit || 0}</span></div>
            <div><label>Bonus:</label><span class="field bonus">${user.bonus || 0}</span></div>
            <div><label>Earnings:</label><span class="field earnings">${user.earnings || 0}</span></div>
            <div><label>Profit:</label><span class="field profit">${user.profit || 0}</span></div>
            <div><label>Withdrawn:</label><span class="field withdrawn">${user.withdrawn || 0}</span></div>

            <div class="action-buttons" id="buttons-${user.id}">
              <button class="edit-btn" onclick="editUser('${user.id}')">Edit</button>
              <button class="delete-btn" onclick="deleteUser('${user.id}')">Delete</button>
            </div>
          `;

          container.appendChild(card);
        });

        userCount.textContent = filtered.length;
      });
    }

    function editUser(userId) {
      const card = document.getElementById(`card-${userId}`);
      const fields = card.querySelectorAll('.field');

      fields.forEach(field => {
        const value = field.textContent;
        const key = field.classList[1];
        field.outerHTML = `<input class="edit-input" data-key="${key}" value="${value}">`;
      });

      document.getElementById(`buttons-${userId}`).innerHTML = `
        <button class="save-btn" onclick="saveUser('${userId}')">Save</button>
        <button class="cancel-btn" onclick="loadUsers()">Cancel</button>
      `;
    }

    function saveUser(userId) {
      const card = document.getElementById(`card-${userId}`);
      const inputs = card.querySelectorAll('.edit-input');
      const updatedData = {};

      inputs.forEach(input => {
        const key = input.dataset.key;
        let value = input.value;

        if (['balance','deposit','bonus','earnings','profit','pending','withdrawn'].includes(key)) {
          value = Number(value) || 0;
        }

        updatedData[key] = value;
      });

      database.ref('users/' + userId).update(updatedData)
        .then(() => {
          alert('User updated successfully');
          loadUsers();
        });
    }

    function deleteUser(userId) {
      if (confirm('Are you sure you want to delete this user?')) {
        database.ref('users/' + userId).remove().then(loadUsers);
      }
    }

    loadUsers();
  </script>
</body>
</html>
